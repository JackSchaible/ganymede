<h2>Your Spells <i class="fas fa-wand-magic"></i></h2>

<div class="u-flex">
  <main class="mat-elevation-z8 u-margin-top-2x flex-grow-1">
    <div class="u-flex u-flex__justify--space-between">
      <div class="u-margin-x">
        <p class="w-100">Filter By:</p>

        <form [formGroup]="formGroup" class="u-flex u-flex__wrap">
          <mat-form-field>
            <input matInput placeholder="Name" type="text" (keyup)="filter()" formControlName="name" [(ngModel)]="nameFilter">
          </mat-form-field>

          <mat-form-field>
            <mat-select placeholder="Class" [(value)]="classFilter" (selectionChange)="filter()">
              <mat-option *ngFor="let cls of classes" [value]="cls">{{cls | titlecase}}</mat-option>
            </mat-select>
          </mat-form-field>
        </form>
      </div>

      <div class="u-padding">
        <a mat-raised-button routerLink="/spells/add">
          <i class="fa fa-plus-square u-margin-right-half"></i> Add New Spell
        </a>
      </div>
    </div>

    <table mat-table matSort [dataSource]="spells" class="w-100">
      <tr mat-header-row *matHeaderRowDef="colsToDisplay"></tr>
      <tr mat-row *matRowDef="let row; columns: colsToDisplay" (click)="selected(row)"></tr>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
        <td mat-cell *matCellDef="let spell"> {{spell.name}} </td>
      </ng-container>

      <ng-container matColumnDef="level">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Level </th>
        <td mat-cell *matCellDef="let spell"> {{spell.level}} </td>
      </ng-container>

      <ng-container matColumnDef="castingTime">
        <th mat-header-cell *matHeaderCellDef> Casting Time </th>
        <td mat-cell *matCellDef="let spell">
          <span *ngIf="spell.castingTime.timeType !== 'Reaction'">{{spell.castingTime.amount}}</span>
          {{spell.castingTime.timeType}}
        </td>
      </ng-container>

      <ng-container matColumnDef="range">
        <th mat-header-cell *matHeaderCellDef> Range </th>
        <td mat-cell *matCellDef="let spell">
          <span *ngIf="spell.range.rangeType !== 'Self' && spell.range.rangeType !== 'Touch'">
            {{spell.range.amount}}
          </span>
          {{spell.range.rangeType}}
        </td>
      </ng-container>

      <ng-container matColumnDef="components">
        <th mat-header-cell *matHeaderCellDef> Components </th>
        <td mat-cell *matCellDef="let spell">
          <span *ngIf="spell && spell.components">
            <span *ngIf="spell.components.verbal">V<span *ngIf="spell.components.somatic || spell.components.material">,</span></span>
            <span *ngIf="spell.components.somatic">S<span *ngIf="spell.components.material">,</span></span>
            <span *ngIf="spell.components.material">M</span>
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="duration">
        <th mat-header-cell *matHeaderCellDef> Duration </th>
        <td mat-cell *matCellDef="let spell">
          <p *ngIf="spell.duration.concentration">Up to {{spell.duration.length}}
            {{spell.duration.durationType}}</p>
          <p *ngIf="!spell.duration.concentration" class="details-value">
            <span *ngIf="spell.duration.durationType === 'round' || spell.duration.durationType === 'minute' || spell.duration.durationType === 'hour' || spell.duration.durationType === 'day' || spell.duration.durationType === 'year'">
              {{spell.duration.length}}
            </span>{{spell.duration.durationType}}
          </p>
        </td>
      </ng-container>
    </table>

    <mat-paginator [pageSizeOptions]="[10, 20]" showFirstLastButtons></mat-paginator>
  </main>

  <div>
    <div class="u-flex u-flex__justify--end u-margin-bottom">
        <a mat-raised-button (click)="editSpell()" class="u-margin-left" *ngIf="selectedSpell">
          <i class="fas fa-edit"></i>
          <span class="u-margin-left-half">Edit Spell</span>
        </a>

      <a mat-raised-button (click)="closeCard()" class="u-margin-left" *ngIf="selectedSpell">
        <i class="fas fa-times-circle"></i>
        <span class="u-margin-left-half">Close Spell Card</span>
      </a>
    </div>

    <gm-spell-card [spell]="selectedSpell" *ngIf="selectedSpell"></gm-spell-card>
  </div>
</div>